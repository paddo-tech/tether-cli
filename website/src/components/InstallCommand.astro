---
interface Props {
  command: string;
  label?: string;
}

const { command, label = 'Install with Homebrew' } = Astro.props;
const id = `install-${Math.random().toString(36).substr(2, 9)}`;
---

<div class="relative">
  <button
    class="install-button group w-full sm:w-auto flex items-center justify-between space-x-4 px-6 py-4 bg-primary hover:bg-primary/90 text-background rounded-lg transition-all font-mono font-semibold shadow-lg hover:shadow-xl"
    data-install-button
    data-command-id={id}
  >
    <span class="flex items-center space-x-3">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
      </svg>
      <span>{label}</span>
    </span>
    <span class="copy-icon">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
      </svg>
    </span>
  </button>

  <div class="mt-2 p-3 bg-surface rounded border border-surface text-sm font-mono text-muted">
    <code id={id}>{command}</code>
  </div>
</div>

<script>
  document.querySelectorAll('[data-install-button]').forEach((button) => {
    button.addEventListener('click', async () => {
      const commandId = button.getAttribute('data-command-id');
      const codeElement = document.getElementById(commandId!);
      const command = codeElement?.textContent || '';

      try {
        await navigator.clipboard.writeText(command.trim());

        // Visual feedback
        const icon = button.querySelector('.copy-icon svg');
        const originalHTML = icon?.innerHTML;

        if (icon) {
          icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />`;

          // Show tooltip
          const tooltip = document.createElement('div');
          tooltip.className = 'absolute -top-10 left-1/2 transform -translate-x-1/2 px-3 py-1 bg-success text-background text-sm rounded font-mono';
          tooltip.textContent = 'Copied!';
          button.appendChild(tooltip);

          setTimeout(() => {
            if (originalHTML) {
              icon.innerHTML = originalHTML;
            }
            tooltip.remove();
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>

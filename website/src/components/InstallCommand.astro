---
interface Props {
  command: string;
  label?: string;
}

const { command } = Astro.props;
const id = `install-${Math.random().toString(36).substr(2, 9)}`;
---

<button
  class="install-button group flex items-center space-x-3 px-4 py-3 bg-surface hover:bg-surface/80 text-text rounded-lg transition-all font-mono border border-surface hover:border-primary/30"
  data-install-button
  data-command-id={id}
>
  <code id={id} class="text-muted">{command}</code>
  <span class="copy-icon text-primary">
    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
    </svg>
  </span>
</button>

<script>
  document.querySelectorAll('[data-install-button]').forEach((button) => {
    button.addEventListener('click', async () => {
      const commandId = button.getAttribute('data-command-id');
      const codeElement = document.getElementById(commandId!);
      const command = codeElement?.textContent || '';

      try {
        await navigator.clipboard.writeText(command.trim());

        const icon = button.querySelector('.copy-icon svg');
        const originalHTML = icon?.innerHTML;

        if (icon) {
          icon.innerHTML = `<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />`;

          setTimeout(() => {
            if (originalHTML) {
              icon.innerHTML = originalHTML;
            }
          }, 2000);
        }
      } catch (err) {
        console.error('Failed to copy:', err);
      }
    });
  });
</script>
